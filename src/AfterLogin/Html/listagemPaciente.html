<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/remixicon@3.2.0/fonts/remixicon.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../Css/listagemPaciente.css">
    <link rel="stylesheet" href="../Css/Sidebar.css">
    <link rel="shortcut icon" href="../../Assets/logo_Multclinics_branca_sem_nome.png" type="image/x-icon">
    <title>Multiclinics | Área do Paciente</title>
</head>

<body>
    <nav id="sidebar">
        <div id="sidebar_content">
            <div id="user">
                <img src="../Assets/perfil.jpeg" id="user_avatar" alt="Avatar">

                <p id="user_infos">
                    <span id="user_nome" class="item-description">Silvia</span>
                    <span id="user_permissao" class="item-description">ADM</span>
                </p>
            </div>

            <ul id="side_items">
                <li class="side-item">
                    <a href="homePosLoginMedico.html">
                        <i class="fa-solid fa-home"></i>
                        <span class="item-description">
                            Home
                        </span>
                    </a>
                </li>

                <li class="side-item">
                    <a href="calendario.html">
                        <i class="fa-solid fa-calendar"></i>
                        <span class="item-description">
                            Agendamento
                        </span>
                    </a>
                </li>

                <li class="side-item">
                    <a href="listagemColaborador.html">
                        <i class="fa-solid fa-user"></i>
                        <span class="item-description">
                            Colaborador
                        </span>
                    </a>
                </li>

                <li class="side-item active">
                    <a href="listagemPaciente.html">
                        <i class="fa-solid fa-hospital-user"></i>
                        <span class="item-description">
                            Paciente
                        </span>
                    </a>
                </li>

                <li class="side-item">
                    <a href="dashboards.html">
                        <i class="fa-solid fa-chart-line"></i>
                        <span class="item-description">
                            Dashboards
                        </span>
                    </a>
                </li>

                <li class="side-item">
                    <a href="listagemLead.html">
                        <i class="fa-solid fa-filter"></i>
                        <span class="item-description">
                            Leads
                        </span>
                    </a>
                </li>
            </ul>

            <button id="open_btn">
                <i id="open_btn_icon" class="fa-solid fa-chevron-right"></i>
            </button>
        </div>

        <div id="logout">
            <button onclick="deslogar()" id="logout_btn">
                <i class="fa-solid fa-right-from-bracket"></i>
                <span class="item-description">
                    Logout
                </span>
            </button>
        </div>
    </nav>

    <main>
        <div class="container">
            <div class="header">
                <h1>Área dos <span>Pacientes</span></h1>
                <div class="containerBotao">
                    <button class="registrar" id="addPacienteBtn">Adicionar Paciente</button>
                    <button class="filtro">Filtro</button>
                </div>
            </div>
            <div class="KPIS">
                <div class="cardKpi">
                    <div class="kpiContent">
                        <div class="kpiData">
                            <p class="kpiNumber"></p>
                            <p class="kpiText">Tratamento ABA</p>
                            <p class="kpiSubtext">Número de pacientes que fazem tratamento ABA</p>
                        </div>
                        <div class="kpiIcon">
                            <img src="../Assets/images.jfif" alt="Ícone">
                        </div>
                    </div>
                </div>
                <div class="cardKpi">
                    <div class="kpiContent">
                        <div class="kpiData">
                            <p class="kpiNumber"></p>
                            <p class="kpiText">Pacientes</p>
                            <p class="kpiSubtext">Número de pacientes ativos fazendo tratamento</p>
                        </div>
                        <div class="kpiIcon">
                            <img src="../Assets/images.jfif" alt="Ícone">
                        </div>
                    </div>
                </div>
                <div class="cardKpi">
                    <div class="kpiContent">
                        <div class="kpiData">
                            <p class="kpiNumber"></p>
                            <p class="kpiText">Agendamentos</p>
                            <p class="kpiSubtext">Número de agendamentos expirando essa semana</p>
                        </div>
                        <div class="kpiIcon">
                            <img src="../Assets/images.jfif" alt="Ícone">
                        </div>
                    </div>
                </div>
                <div class="cardKpi">
                    <div class="kpiContent">
                        <div class="kpiData">
                            <p class="kpiNumber"></p>
                            <p class="kpiText">Pacientes</p>
                            <p class="kpiSubtext">Pacientes adicionados no último trimestre</p>
                        </div>
                        <div class="kpiIcon">
                            <img src="../Assets/images.jfif" alt="Ícone">
                        </div>
                    </div>
                </div>
            </div>
            <div class="listagemBox" id="listagem"></div>
        </div>
        </div>

    </main>
    <script src="../Js/listagemPaciente.js"></script>
    <script src="../Js/funcoesPadroes.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../Js/sessao.js"></script>

    <!-- Script do SweetAlert para perguntar sobre a idade do paciente -->
    <script>
        // Captura o botão de "Adicionar Paciente"
        const addPacienteBtn = document.getElementById('addPacienteBtn');

        // Função para exibir o SweetAlert ao clicar no botão
        addPacienteBtn.addEventListener('click', async (event) => {
            event.preventDefault(); // Evita o comportamento padrão do botão

            const result = await Swal.fire({
                title: "O paciente é menor de 15 anos?",
                icon: "question",
                showCancelButton: true,
                confirmButtonText: "Sim",
                cancelButtonText: "Não",
                reverseButtons: true
            });

            if (result.isConfirmed) {
                // Perguntar o CPF do responsável
                const { value: cpfResponsavel } = await Swal.fire({
                    title: "Digite o CPF do responsável",
                    input: 'text',
                    inputLabel: 'CPF do responsável',
                    inputPlaceholder: 'Digite o CPF aqui',
                    showCancelButton: true,
                    confirmButtonText: 'Verificar',
                    cancelButtonText: 'Cancelar',
                    inputValidator: (value) => {
                        if (!value) {
                            return 'Você deve inserir um CPF!';
                        }
                    }
                });

                if (cpfResponsavel) {
                    // Verificar se o CPF do responsável já existe
                    try {
                        const response = await fetch(`http://localhost:8080/responsaveis/cpf?cpf=${cpfResponsavel}`);
                        if (response.ok) {
                            const responsavel = await response.json();

                            if (responsavel && responsavel.id) {
                                // Se o responsável já existe, redirecionar para a página de cadastro do paciente com o ID do responsável
                                window.location.href = `cadastroPacienteComResponsavel.html?idResponsavel=${responsavel.id}`;
                            }
                        } else if (response.status === 404) {
                            // Se não existir, redirecionar para a tela de cadastro do responsável
                            Swal.fire({
                                icon: 'info',
                                title: 'Responsável não encontrado',
                                text: 'Por favor, cadastre o responsável primeiro.',
                            }).then(() => {
                                window.location.href = 'cadastroResponsavel.html';
                            });
                        }
                    } catch (error) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Erro ao verificar CPF',
                            text: 'Ocorreu um erro ao tentar verificar o CPF: ' + error.message,
                        });
                    }
                }
            } else {
                // Para pacientes maiores de 15 anos
                Swal.fire({
                    title: "Paciente maior de 15 anos",
                    text: "Continuando com o cadastro do paciente...",
                    icon: "success"
                }).then(() => {
                    // Redirecionar para a página de cadastro após a confirmação
                    window.location.href = 'cadastroPaciente.html';
                });
            }
        });
    </script>

</body>

</html>