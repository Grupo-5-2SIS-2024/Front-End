<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiclinics Agenda</title>
    <link rel="stylesheet" href="./css/calendario.css">
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo">Multiclinics<br>Espaço Neuroclin</div>
            <ul class="menu">
                <li>Início</li>
                <li class="active">Agendamento</li>
                <li>Funcionário</li>
                <li>Paciente</li>
                <li>Dashboard</li>
            </ul>
        </div>
        <div class="main-content">
            <div class="header">
                <h2>Veja o seu <span class="highlight">Calendário</span></h2>
                <button class="filter-button" onclick="abrirModalFiltro()">Filtrar</button>

                <!-- Modal de Filtro -->
                <div id="modalFiltro" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="fecharModalFiltro()">&times;</span>
                        <h3>Filtrar Tarefas</h3>
                        <label for="filtroIdade">Idade:</label>
                        <input type="number" id="filtroIdade" placeholder="Idade">
                        <label for="filtroArea">Área:</label>
                        <input type="text" id="filtroArea" placeholder="Área">
                        <button onclick="aplicarFiltros()">Aplicar Filtros</button>
                    </div>
                </div>

                <!-- Modal de Detalhes da Tarefa -->
                <div id="modalDetalhes" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="fecharModalDetalhes()">&times;</span>
                        <h3>Detalhes da Consulta</h3>
                        <div id="detalhesTarefa"></div>
                    </div>
                </div>
            </div>
            <div class="calendar">
                <div id="contagemDias" class="count-dias">
                    <button onclick="semanaPassada()" class="nav-button">&lt;</button>
                    <span id="dias">01 - 07 - Agosto</span>
                    <button onclick="proximaSemana()" class="nav-button">&gt;</button>
                </div>
                <div class="week-days" id="diasSemana"></div>
                <div class="tasks-columns" id="colunasTarefas"></div>
            </div>
        </div>
    </div>
</body>
</html>
<script>
let dataInicioAtual = new Date(new Date().getFullYear(), new Date().getMonth(), 1);

// Simulação de um banco de dados com dados de atividades
const bancoDeDadosTarefas = [
    { date: '2024-08-01', tasks: ['Tratamento de espinhas'], nome: 'Pedro', idade: 17, area: 'Psico' },
    { date: '2024-08-02', tasks: ['Tratamento de unha', 'Consulta médica', 'aaaa', 'aaaa', 'aaaa', 'aaaa'], nome: 'Pedro', idade: 18, area: 'Psico' },
    { date: '2024-08-03', tasks: ['Tratamento de unha'], nome: 'Pedro', idade: 18, area: 'Psico' },
    { date: '2024-08-04', tasks: ['Consulta médica', 'Reunião'], nome: 'Pedro', idade: 18, area: 'Psico' },
    { date: '2024-08-05', tasks: ['Reunião de trabalho'], nome: 'Pedro', idade: 18, area: 'Psico' },
    { date: '2024-08-06', tasks: ['Aula de yoga', 'Reunião'], nome: 'Pedro', idade: 18, area: 'Psico' },
    { date: '2024-08-07', tasks: ['Tratamento de espinhas', 'Compras'] },
];

let bancoDeDadosFiltrado = bancoDeDadosTarefas;

function obterInicioDaSemana(date) {
    const day = date.getDay();
    const diff = (day === 0 ? -6 : 1) - day; // Ajuste para segunda-feira como o primeiro dia da semana
    const startDate = new Date(date);
    startDate.setDate(date.getDate() + diff);
    return startDate;
}

function formatarData(date) {
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    return `${year}-${month}-${day}`;
}

function obterTarefasParaData(date) {
    const formattedDate = formatarData(date);
    const entry = bancoDeDadosFiltrado.find(entry => entry.date === formattedDate);
    return entry ? entry.tasks : ['Sem tarefas'];
}

function atualizarDisplayData(startDate) {
    const endDate = new Date(startDate);
    endDate.setDate(startDate.getDate() + 6);

    const options = { day: '2-digit', month: 'long' };
    const startStr = startDate.toLocaleDateString('pt-BR', options).replace(/^\d{2}/, match => match.padStart(2, '0'));
    const endStr = endDate.toLocaleDateString('pt-BR', options).replace(/^\d{2}/, match => match.padStart(2, '0'));

    document.getElementById('dias').innerText = `${startStr} - ${endStr}`;
    atualizarDiasDaSemana(startDate);
}

function atualizarDiasDaSemana(startDate) {
    const diasSemanaElement = document.getElementById('diasSemana');
    diasSemanaElement.innerHTML = '';

    for (let i = 0; i < 7; i++) {
        const currentDate = new Date(startDate);
        currentDate.setDate(startDate.getDate() + i);

        const options = { weekday: 'short', day: '2-digit' };
        const dayStr = currentDate.toLocaleDateString('pt-BR', options);

        const dayElement = document.createElement('div');
        dayElement.className = 'day';
        dayElement.innerText = dayStr;

        diasSemanaElement.appendChild(dayElement);
    }

    atualizarColunasDeTarefas(startDate);
}

function atualizarColunasDeTarefas(startDate) {
    const colunasTarefasElement = document.getElementById('colunasTarefas');
    colunasTarefasElement.innerHTML = '';

    for (let i = 0; i < 7; i++) {
        const currentDate = new Date(startDate);
        currentDate.setDate(currentDate.getDate() + i);

        const tasks = obterTarefasParaData(currentDate);

        const columnElement = document.createElement('div');
        columnElement.className = 'column';

        tasks.forEach(task => {
            if (task !== 'Sem tarefas') {
                const taskElement = document.createElement('div');
                taskElement.className = 'task';
                taskElement.innerText = task;
                taskElement.onclick = () => abrirDetalhesTarefa(task, currentDate);
                columnElement.appendChild(taskElement);
            } else {
                const taskElement = document.createElement('div');
                taskElement.className = 'task inactive';
                taskElement.innerText = task;
                columnElement.appendChild(taskElement);
            }
        });

        colunasTarefasElement.appendChild(columnElement);
    }
}

function semanaPassada() {
    dataInicioAtual.setDate(dataInicioAtual.getDate() - 7);
    dataInicioAtual = obterInicioDaSemana(dataInicioAtual);
    atualizarDisplayData(dataInicioAtual);
}

function proximaSemana() {
    dataInicioAtual.setDate(dataInicioAtual.getDate() + 7);
    dataInicioAtual = obterInicioDaSemana(dataInicioAtual);
    atualizarDisplayData(dataInicioAtual);
}

// Inicialização
dataInicioAtual = obterInicioDaSemana(dataInicioAtual);
atualizarDisplayData(dataInicioAtual);

function abrirModalFiltro() {
    document.getElementById('modalFiltro').style.display = 'flex';
}

function fecharModalFiltro() {
    document.getElementById('modalFiltro').style.display = 'none';
}

function aplicarFiltros() {
    const idade = document.getElementById('filtroIdade').value;
    const area = document.getElementById('filtroArea').value.toLowerCase();

    bancoDeDadosFiltrado = bancoDeDadosTarefas.filter(entry => {
        const filtroIdade = !idade || entry.idade == idade;
        const filtroArea = !area || (entry.area && entry.area.toLowerCase().includes(area));
        return filtroIdade && filtroArea;
    });

    fecharModalFiltro();
    atualizarDisplayData(dataInicioAtual);
}

function abrirDetalhesTarefa(task, date) {
    const detalhesDiv = document.getElementById('detalhesTarefa');
    detalhesDiv.innerHTML = `<p><strong>Tarefa:</strong> ${task}</p><p><strong>Data:</strong> ${date.toLocaleDateString('pt-BR')}</p>`;
    document.getElementById('modalDetalhes').style.display = 'flex';
}

function fecharModalDetalhes() {
    document.getElementById('modalDetalhes').style.display = 'none';
}
</script>
